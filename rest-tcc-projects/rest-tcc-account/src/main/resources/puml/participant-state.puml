@startuml
skinparam monochrome true
scale 1
title Account Transaction State Machine

' State
state "TRYING[√]" as TRYING
TRYING: + action: initial "state" 0000
TRYING: + action: reduce corresponding col `balance` in t_account
TRYING: + action: recording final field "amount"
TRYING: + action: recording final field "expired_at"
'''
state "CONFIRMED[√]" as CONFIRMED
CONFIRMED: + action: update "state" to 0001
CONFIRMED: + action: set "done_at" as now
'''
state "CANCELLED[√]" as CANCELLED
CANCELLED: + action: update "state" to 0010
CANCELLED: + action: rollback `amount` to the col "balance" in t_account
CANCELLED: + action: set "done_at" as now
' Transition
[*] --> TRYING
TRYING --> CONFIRMED: confirm \n [LocalDateTime.now() is not after than expired_at]
TRYING --> CANCELLED: cancel \n [expired_at is after than LocalDateTime.now()]
CONFIRMED --> [*]
CANCELLED --> [*]
@enduml

